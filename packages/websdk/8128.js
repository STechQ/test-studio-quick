"use strict";(this.webpackChunk_stechquick_websdk=this.webpackChunk_stechquick_websdk||[]).push([[8128],{60118:(e,t,o)=>{o.d(t,{C:()=>s,X:()=>r});var i=!1;new Promise((function(e){return e()})).then((function(){return i=!0})),"undefined"!=typeof doNothing&&doNothing();var n=!0===i;function r(e,t){void 0===t&&(t={});var o,i=void 0,r=void 0,s=function(e){o&&clearTimeout(o),o=setTimeout((function(){r(new Error("The operation has timed out. timeoutValue  : "+e))}),e)},a=!1,u=!1,l=function(){return a||u};return e&&s(e),{startTimer:s,promise:new Promise((function(e,o){var s=function(e){return n&&t.fixSyncResolve?function(t){return setTimeout((function(){return e(t)}))}:e}(e);i=function(e){l()||(a=!0,s(e))},r=function(e){l()||(u=!0,o(e))}})),resolver:i,reject:r,isResolved:function(){return a},isRejected:function(){return u},isCompleted:l}}function s(e){var t=this,o=r(),i=e.length;return e.forEach((function(e){return n=t,r=void 0,a=function(){return function(e,t){var o,i,n,r,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(n=2&r[0]?i.return:r[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,r[1])).done)return n;switch(i=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){s.label=r[1];break}if(6===r[0]&&s.label<n[1]){s.label=n[1],n=r;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(r);break}n[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],i=0}finally{o=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}(this,(function(t){switch(t.label){case 0:return t.trys.push([0,,2,3]),[4,e];case 1:return t.sent(),[3,3];case 2:return--i<=0&&o.resolver(e),[7];case 3:return[2]}}))},new((s=void 0)||(s=Promise))((function(e,t){function o(e){try{u(a.next(e))}catch(e){t(e)}}function i(e){try{u(a.throw(e))}catch(e){t(e)}}function u(t){var n;t.done?e(t.value):(n=t.value,n instanceof s?n:new s((function(e){e(n)}))).then(o,i)}u((a=a.apply(n,r||[])).next())}));var n,r,s,a})),o.promise}},38128:(e,t,o)=>{o.r(t),o.d(t,{PlateauIAM:()=>h});var i=o(64e3),n=o(36348),r=o(62190),s=o(60118);function a(e,t){e.postMessage(t,"*")}var u=function(e,t,o,i){return new(o||(o=Promise))((function(n,r){function s(e){try{u(i.next(e))}catch(e){r(e)}}function a(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,a)}u((i=i.apply(e,t||[])).next())}))},l=function(e,t){var o,i,n,r,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(n=2&r[0]?i.return:r[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,r[1])).done)return n;switch(i=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){s.label=r[1];break}if(6===r[0]&&s.label<n[1]){s.label=n[1],n=r;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(r);break}n[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],i=0}finally{o=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}},c=["https://","http://"],h=function(){function e(){var e=this;this.refreshTime=6e3,this.updateTime=10,this.initOptions={url:"http://identity-provider.dev.rally.softtech/auth/",realm:"main",clientId:"ui-web-client",onLoad:"login-required",pkceMethod:"S256",identityProvider:"",locale:""},this.authOptions={url:"",active:!1},this.iamPlateau=void 0,this.sessionStorageNamePrefix="",this.getToken=function(){return null!=e.iamPlateau?e.iamPlateau.token:void 0},this.getInfo=function(){return null!=e.iamPlateau?e.iamPlateau.info:void 0}}return e.prototype.setOptions=function(e){var t=e.iam,o=e.iamV2;if(null==o?void 0:o.active)this.configureNewOAuthSettings(o);else try{var i=null==t?void 0:t.options;if(!i)throw new Error("iam in settings is missing options");if(null!=i.identityProvider)if("object"==typeof i.identityProvider){var n="",s=i.url.split("."),a=2;try{(a=parseInt(i.identityProvider.order))<=0&&(a=2)}catch(e){a=2}if("queryString"===i.identityProvider.type){var u=new URLSearchParams(window.location.search);if(null!=u.get("subdomain")&&(n=u.get("subdomain"),s[a-1]=n,this.initOptions.subdomain=n),null!=u.get("realm"))i.realm=u.get("realm"),i.sessionStorageNamePrefix||(document.cookie="queryParamsRealmIAM="+i.realm+";path=/;");else if(!i.sessionStorageNamePrefix){var l=this.getItemFromCookies("queryParamsRealmIAM");l&&(i.realm=l)}var c=i.localeQueryStringKey||"ui_locales";if(null!=u.get(c))this.initOptions.locale=u.get(c),i.sessionStorageNamePrefix||(document.cookie="queryParamsLocaleIAM="+this.initOptions.locale+";path=/;");else if(this.initOptions.locale=void 0,!i.sessionStorageNamePrefix){var h=this.getItemFromCookies("queryParamsLocaleIAM");h&&(this.initOptions.locale=h)}}else"subdomain"===i.identityProvider.type&&(n=window.location.host.split(".")[0],s[a-1]=n);i.url=s.join(".")}else i.identityProvider.length>1&&(i.url=window.location.protocol+"//"+window.location.host.replace(i.identityProvider,"identity-provider")+"/auth");i.url&&(this.initOptions.url=i.url),i.realm&&(this.initOptions.realm=i.realm),i.clientId&&(this.initOptions.clientId=i.clientId),i.onLoad&&(this.initOptions.onLoad=i.onLoad),i.pkceMethod&&(this.initOptions.pkceMethod=i.pkceMethod),i.identityProvider&&(this.initOptions.identityProvider=i.identityProvider),i.redirectUri&&(this.initOptions.redirectUri=i.redirectUri),i.responseMode&&(this.initOptions.responseMode=i.responseMode),i.preserveTokens&&(this.initOptions.preserveTokens=i.preserveTokens)}catch(e){var p=e.message||"error has no message";r.Y.Log({logMessage:"Error on setting IAM options: "+p,logType:r.h.Error})}},e.prototype.getItemFromCookies=function(e){var t,o,i,n=document.cookie.split(";");for(t=0;t<n.length;t++)if(o=n[t].substr(0,n[t].indexOf("=")),i=n[t].substr(n[t].indexOf("=")+1),(o=o.replace(/^\s+|\s+$/g,""))==e)return unescape(i)},e.prototype.configureNewOAuthSettings=function(e){this.authOptions.active=e.active;var t=e.idendityProviderURL||"",o=new URLSearchParams(window.location.search);this.authOptions.subdomain=this.getSubdomain(e,o),t=this.replaceSubdomain(t,this.authOptions),this.authOptions.realm=this.getRealm(e,o),this.authOptions.language=this.getLocale(e,o),this.authOptions.url=t,this.authOptions.clientId=e.clientId,this.authOptions.preserveTokens=e.preserveTokens,this.authOptions.redirectUri=e.redirectUri,this.authOptions.onLoad=e.onLoad,this.authOptions.popup=e.popup,this.authOptions.sessionStorageNamePrefix=e.sessionStorageNamePrefix},e.prototype.getLocale=function(e,t){return e.isLangFromQS?t.get("lang"):e.language},e.prototype.replaceSubdomain=function(e,t){var o=e.split(".");return o[1]=t.subdomain||o[1],o.join(".")},e.prototype.getRealm=function(e,t){return e.isRealmFromQS?t.get("realm"):e.realm},e.prototype.getSubdomain=function(e,t){var o="";switch(e.subdomainSource){case"constant":o=e.subdomainValue;break;case"query":o=t.get("subdomain");break;case"currentDomain":o=window.location.host.split(".")[0]}return o},e.prototype.isAuthenticated=function(){var e;if(null!=(null===(e=this.iamPlateau)||void 0===e?void 0:e.token))return!0},e.prototype.init=function(e,t){var o,n,r,s,a,c,h,p,d;return u(this,void 0,void 0,(function(){var u,f,v,k,m,g,y;return l(this,(function(l){switch(l.label){case 0:return u=this.authOptions.active?this.authOptions:this.initOptions,this.sessionStorageNamePrefix=(null===(r=null===(n=null===(o=this.settingsIAM)||void 0===o?void 0:o.iam)||void 0===n?void 0:n.options)||void 0===r?void 0:r.sessionStorageNamePrefix)||this.authOptions.sessionStorageNamePrefix?((null===(c=null===(a=null===(s=this.settingsIAM)||void 0===s?void 0:s.iam)||void 0===a?void 0:a.options)||void 0===c?void 0:c.sessionStorageNamePrefix)||this.authOptions.sessionStorageNamePrefix)+"_":"",this.keycloak=(0,i.Z)(u),f=this.getTokens(),v=this.getKeyCloakOptions(),k=this.getLoginOptions(),f&&f.idToken&&f.refreshToken&&f.token&&(v.idToken=f.idToken,v.refreshToken=f.refreshToken,v.token=f.token),m=this.authOptions.active?this.authOptions.redirectUri:this.initOptions.redirectUri,(g=this.setQueryOrFragment(new URL(window.location.href),m))&&(k.redirectUri=g,v.redirectUri=g),y=!1,(null!==(h=null==t?void 0:t.iamWithPopup)&&void 0!==h?h:(null===(d=null===(p=this.settingsIAM)||void 0===p?void 0:p.iam)||void 0===d?void 0:d.popup)||this.authOptions.popup)&&!(null==t?void 0:t.iamInPopup)?[4,this.handleIAMPopup(t,v,this.keycloak)]:[3,2];case 1:return y=l.sent(),[3,5];case 2:return[4,this.keycloak.init(v)];case 3:return(y=l.sent())?[3,5]:[4,this.keycloak.login(k)];case 4:return l.sent(),[2];case 5:return(null==t?void 0:t.iamInPopup)?(this.handleInPopup(),[2]):(this.setTokens(),"boolean"==typeof y&&(y?this.constructIAMPlateau():window.location.reload(),e()),[2])}}))}))},e.prototype.handleIAMPopup=function(e,t,o){return u(this,void 0,void 0,(function(){var i,r,c,h,p,d,f,v=this;return l(this,(function(k){switch(k.label){case 0:if(r=(0,s.X)(),c=function(e){var t={};for(var o in e)if(e.hasOwnProperty(o)){var i=e[o];"string"!=typeof i&&"number"!=typeof i&&"boolean"!=typeof i&&null!==i||(t[o]=i)}return t},h=function(t){return u(v,void 0,void 0,(function(){var o;return l(this,(function(n){if(t.source!=p)return[2];switch(t.data.type){case"setTokens":return window.removeEventListener("message",h),"setTokens"==t.data.type&&r.resolver(t.data.tokenInfo),clearInterval(i),[2];case"iamReady":return o=c(window),a(p,{type:"iamOptions",options:e,tokens:this.getTokens(),sessionStorageNamePrefix:this.sessionStorageNamePrefix,parentWindow:o}),[2]}return[2]}))}))},window.addEventListener("message",h),!(p=window.open(n.t.concatUrl(n.t.getScriptRoot(),"../assets/oidc.html"),"plateauIAMPopup","popup")))throw d="Failed to open new window.",console.error(d),d;return i=setInterval((function(){if(p.closed){clearInterval(i);var e="popup window closed before authentication";console.error(e),r.reject(new Error(e))}}),500),[4,r.promise];case 1:return f=k.sent(),this.setToOptions(t,f),[2,o.init(t)]}}))}))},e.prototype.handleInPopup=function(){var e=this.getTokenFromKeycloak();if(!e)throw new Error("could not retrieve tokenInfo from keycloak");a(opener,{type:"setTokens",tokenInfo:e}),window.close()},e.prototype.pathJoin=function(e,t){return(e=e.endsWith("/")?e.substring(0,e.length-1):e)+"/"+(t.startsWith("/")?t.substring(1):t)},e.prototype.setQueryOrFragment=function(e,t){if(t){if(null!=c.find((function(e){return t.startsWith(e)})))return t;var o=new URL("http://a.com/"+t),i="/"==e.pathname?"":e.pathname,n="/"==o.pathname?"":o.pathname,r=i&&n?n.startsWith("//")?n.substring(1):this.pathJoin(i,n):i||n,s=e.search&&o.search?e.search+o.search.replace("?","&"):e.search||o.search,a=e.hash&&o.hash?e.hash+o.hash.replace("#","&"):e.hash||o.hash;return e.origin+r+s+a}},e.prototype.constructIAMPlateau=function(){var e,t,o;null==this.iamPlateau?this.iamPlateau={token:null===(e=this.keycloak)||void 0===e?void 0:e.token,info:null===(t=this.keycloak)||void 0===t?void 0:t.tokenParsed}:this.iamPlateau.token=null===(o=this.keycloak)||void 0===o?void 0:o.token,window.location.search&&(document.cookie="queryParamsIAM="+window.location.search+";path=/;")},e.prototype.getTokens=function(){var e,t,o,i,n,r;if(this.authOptions.preserveTokens||(null===(o=null===(t=null===(e=this.settingsIAM)||void 0===e?void 0:e.iam)||void 0===t?void 0:t.options)||void 0===o?void 0:o.preserveTokens))return{idToken:null!==(i=sessionStorage.getItem(this.sessionStorageNamePrefix+"kcIdToken"))&&void 0!==i?i:void 0,refreshToken:null!==(n=sessionStorage.getItem(this.sessionStorageNamePrefix+"kcRefreshToken"))&&void 0!==n?n:void 0,token:null!==(r=sessionStorage.getItem(this.sessionStorageNamePrefix+"kcToken"))&&void 0!==r?r:void 0}},e.prototype.getTokenFromKeycloak=function(){if(this.keycloak&&this.keycloak.idToken&&this.keycloak.refreshToken&&this.keycloak.token)return{idToken:this.keycloak.idToken,refreshToken:this.keycloak.refreshToken,token:this.keycloak.token,info:this.keycloak.tokenParsed}},e.prototype.setToOptions=function(e,t){e.idToken=t.idToken,e.refreshToken=t.refreshToken,e.token=t.token},e.prototype.setTokens=function(e){var t,o,i,n;if(void 0===e&&(e={}),this.authOptions.preserveTokens||(null===(i=null===(o=null===(t=this.settingsIAM)||void 0===t?void 0:t.iam)||void 0===o?void 0:o.options)||void 0===i?void 0:i.preserveTokens)){var r=null!==(n=e.tokenInfo)&&void 0!==n?n:this.getTokenFromKeycloak();r&&(sessionStorage.setItem(this.sessionStorageNamePrefix+"kcIdToken",r.idToken),sessionStorage.setItem(this.sessionStorageNamePrefix+"kcRefreshToken",r.refreshToken),sessionStorage.setItem(this.sessionStorageNamePrefix+"kcToken",r.token))}},e.prototype.refreshPromise=function(){var e;return u(this,void 0,void 0,(function(){var t;return l(this,(function(o){switch(o.label){case 0:t=!1,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,null===(e=this.keycloak)||void 0===e?void 0:e.updateToken(this.updateTime)];case 2:return t=o.sent(),this.constructIAMPlateau(),this.setTokens(),[3,4];case 3:return o.sent(),window.location.href=window.location.protocol+"//"+window.location.host,[3,4];case 4:return[2,t]}}))}))},e.prototype.getKeyCloakOptions=function(){return this.authOptions.active?{onLoad:"login-required",pkceMethod:"S256",checkLoginIframe:!1,responseMode:"fragment"}:{onLoad:this.initOptions.onLoad,pkceMethod:this.initOptions.pkceMethod,checkLoginIframe:!1,responseMode:this.initOptions.responseMode}},e.prototype.getLoginOptions=function(){return{locale:this.authOptions.language||this.initOptions.locale}},e.prototype.logout=function(){var e,t,o=window.location.protocol+"//"+window.location.host,i=this.getLogoutURLParams();o=this.getRedirectURL(i,o),r.Y.Log({logMessage:"getredirectURL:"}),r.Y.Log({logMessage:o});var n={redirectUri:o},s={redirectUri:null===(e=this.keycloak)||void 0===e?void 0:e.createLogoutUrl(n)};null===(t=this.keycloak)||void 0===t||t.logout(s)},e.prototype.getRedirectURL=function(e,t){return(this.authOptions.active||"queryString"===this.initOptions.identityProvider.type)&&e.reduce((function(e,o,i){return o.value?t=t+(0===i?"?":"&")+o.key+"="+o.value:e}),""),t},e.prototype.getLogoutURLParams=function(){var e=this.authOptions.active?this.authOptions:this.initOptions,t=this.authOptions.active?this.authOptions.language:this.initOptions.locale;return[{key:"realm",value:e.realm},{key:"subdomain",value:e.subdomain},{key:"lang",value:t}]},e.prototype.login=function(e){return u(this,void 0,void 0,(function(){var t;return l(this,(function(o){switch(o.label){case 0:return t=function(){},[4,this.init(t,e)];case 1:return o.sent(),[2]}}))}))},e}()}}]);